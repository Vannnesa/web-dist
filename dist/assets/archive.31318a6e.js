import{a as G,b as ce,a$ as W,dY as de,dZ as ue,k as ge,m as d,x as he,h as e,U as me,K as H,L as K,H as N,R as fe,a0 as we,a1 as L,a3 as be,S as V,a6 as h,aE as pe,ad as xe,a7 as Y,J as Z,ds as _e,aj as E,N as ke,aC as Q,aq as $e,cn as ye,d4 as Ce,ai as je,bJ as ve,cz as Me,aL as Se,al as Le,am as Pe,aB as Oe,_ as P,t as m,d_ as Be,l as ze,aK as Ee}from"./index.aafac351.js";import{L as Ie,c as f}from"./List.4b7548fc.js";import{T as Ae,c as qe}from"./index.af628320.js";import Te from"./Password.9b47e3c2.js";import{a as Fe}from"./helper.490eec7f.js";import{g as Re}from"./icon.aa232460.js";import{x as O,w as Ue,b as De}from"./style.9dd7af46.js";import"./index.cafec582.js";import"./index.174029cb.js";import"./Layout.ec4b4e5c.js";import"./useTitle.24577bd7.js";import"./FolderTree.f21da441.js";import"./index.badfda4f.js";function Je(){let n=!1,o=[];return{acquire:()=>new Promise(a=>{n?o.push(a):(n=!0,a())}),release:()=>{o.length>0?o.shift()():n=!1}}}const X=n=>{window.open(n,"_blank")},We=n=>{const{show:o}=De({id:2}),{isMouseSupported:a}=Fe(),u=()=>ze.list_item_filename_overflow;return e(je.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(E,{class:"list-item viselect-item",get["data-index"](){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:ke()}},get cursor(){return a()?"default":"pointer"},"on:click":w=>{n.obj.is_dir?n.jumpCallback():n.url&&X(n.url)},onContextMenu:w=>{o(w,{props:n})},get children(){return[e(E,{class:"name-box",spacing:"$1",get w(){return f[0].w},get children(){return[e(Q,{class:"icon",boxSize:"$6",get color(){return $e()},get as(){return Re(n.obj)},mr:"$1"}),e(h,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:u()==="multi_line"?"unset":"nowrap","overflow-x":u()==="scrollable"?"auto":"hidden",textOverflow:u()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(h,{class:"size",get w(){return f[1].w},get textAlign(){return f[1].textAlign},get children(){return ye(n.obj.size)}}),e(h,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return f[2].w},get textAlign(){return f[2].textAlign},get children(){return Ce(n.obj.modified)}})]}})}})},B={extract:{icon:Ae,color:"$success9"},copy_link:{icon:qe,color:"$info9"},download:{icon:Ee,color:"$primary9"}},He=()=>{const{copy:n}=ve(),{colorMode:o}=Me();return e(Ue,{id:2,animation:"scale",get theme(){return o()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(O,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{X(a.url+"&attachment=true")},get children(){return e(z,{name:"download"})}}),e(O,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{n(a.url)},get children(){return e(z,{name:"copy_link"})}}),e(O,{hidden:()=>{const a=Se.findIndex(u=>u==="decompress");return!Le.can(Pe(),a)},onClick:({props:a})=>{Oe.emit("extract",JSON.stringify({inner:a.innerPath,pass:a.pass}))},get children(){return e(z,{name:"extract"})}})]}})},z=n=>{const o=G();return e(E,{spacing:"$2",get children(){return[e(Q,{get p(){return B[n.name].p?"$1":void 0},get as(){return B[n.name].icon},boxSize:"$7",get color(){return B[n.name].color}}),e(h,{get children(){return o(`home.toolbar.${n.name}`)}})]}})},st=()=>{const n=G(),{pathname:o}=ce(),[a,u]=W(de),[w,I]=W(ue),ee=ge(()=>a()||w());let l="",k="",$="",b=null;const[y,p]=d(""),[te,A]=d(!1),[C,j]=d(!1),[q,re]=d(""),[c,v]=d([]),[M,T]=d(),[ne,F]=d(!1),[ae,R]=d(""),g=Je(),x=r=>{let s={};return r.forEach(t=>{s[t.name]={...t,children:t.children?x(t.children):null}}),s},S=r=>r.code===200?!1:(r.code===202?m(()=>{l!==""&&A(!0),j(!0),p("")}):p(r.message),!0),U=async r=>{if(await g.acquire(),C()&&l==="")return g.release(),[];if(k===""){const t=await u(o(),P(),l);if(S(t))return g.release(),[];if(t.data.content!==null&&(b=x(t.data.content)),k=t.data.raw_url,$=t.data.sign,re(t.data.comment),t.data.sort!==void 0){let i;t.data.sort.order_by!==""&&(i=t.data.sort.order_by);let _=t.data.sort.order_direction==="desc",le=t.data.sort.extract_folder;m(()=>{T(i),F(_),R(le)})}if(t.data.encrypted&&l==="")return m(()=>{j(!0),p("")}),g.release(),[]}if(b===null){const t=await I(o(),P(),l,"/");if(S(t))return g.release(),[];b=x(t.data.content)}let s=b;for(let t=0;t<r.length;t++){if(s[r[t]].children===null){const i=await I(o(),P(),l,"/"+r.slice(0,t+1).join("/"));if(S(i))return g.release(),[];s[r[t]].children=x(i.data.content)}s=s[r[t]].children}return m(()=>{j(!1),A(!1),p("")}),g.release(),Object.values(s)},[se,D]=d([]);he(()=>{U(c()).then(r=>D(r))});const J=()=>{U(c()).then(r=>D(r))};J();const ie=()=>{let r=se();M()&&(r=r.sort((t,i)=>(ne()?-1:1)*Be(t[M()],i[M()])));let s=ae();if(s!==""){let t=[],i=[];r.forEach(_=>(_.is_dir?t:i).push(_)),r=s==="front"?t.concat(i):i.concat(t)}return r},oe=(r,s)=>{m(()=>{R(""),T(r),s!==void 0&&F(s)})};return e(Y,{spacing:"$2",w:"$full",get children(){return[e(me,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(H,{get children(){return e(K,{get currentPage(){return c().length===0},"on:click":()=>v([]),children:"."})}}),e(N,{get each(){return c()},children:(r,s)=>e(H,{get children(){return[e(fe,{}),e(K,{get currentPage(){return c().length===s()+1},"on:click":()=>v(c().slice(0,s()+1)),children:r})]}})})]}}),e(we,{get children(){return[e(L,{get when(){return y()!==""},get children(){return e(be,{get msg(){return y()},disableColor:!0})}}),e(L,{get when(){return C()},get children(){return e(Te,{get title(){return n("home.toolbar.archive.input_password")},password:()=>l,setPassword:r=>l=r,enterCallback:()=>J(),get children(){return e(V,{get when(){return te()},get children(){return e(h,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(L,{get when(){return pe(()=>!C(),!0)()&&y()===""},get children(){return e(xe,{get loading(){return ee()},get children(){return e(Y,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Ie,{sortCallback:oe,disableCheckbox:!0}),e(N,{get each(){return ie()},children:(r,s)=>{let t,i=(c().length>0?"/"+c().join("/"):"")+"/"+r.name;return r.is_dir||(t=k+"?inner="+Z(i),l!==""&&(t=t+"&pass="+Z(l)),$!==""&&(t=t+"&sign="+$)),e(We,{obj:r,get index(){return s()},jumpCallback:()=>v(c().concat(r.name)),innerPath:i,url:t,pass:l})}}),e(He,{})]}})}})}})]}}),e(V,{get when(){return q()!==""},get children(){return[e(_e,{}),e(h,{w:"$full",pl:"$1",pr:"$1",get children(){return q()}})]}})]}})};export{st as default};
